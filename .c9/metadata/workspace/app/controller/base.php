{"filter":false,"title":"base.php","tooltip":"/app/controller/base.php","undoManager":{"mark":35,"position":35,"stack":[[{"start":{"row":0,"column":0},"end":{"row":51,"column":1},"action":"insert","lines":["<?php","namespace Controller;","","use RedBeanPHP\\R;","","class Base extends \\Prefab","{","    protected $f3;","    protected $view;","","    /**","     * ","     */","    public function __construct()","    {","        // framework","        $this->f3 = \\Base::instance();","        ","        // set framework into view scope","        $this->f3->set('f3', $this->f3);","        $this->f3->set('helper', \\Model\\Helper::instance());","        $this->f3->set('rbac', \\Model\\RBAC::instance());","        ","        // set flashbag from session","        $this->f3->set('flashbag', $this->f3->get('SESSION.flashbag'));","        ","        // start view","        $this->view = new \\View;","        ","        // detect language change","        if ($this->f3->get('GET.lang')) {","            if (in_array($this->f3->get('GET.lang'), $this->f3->get('SUPPORTED_LANGUAGE'))) {","                setcookie(","                    'lang',","                    $this->f3->get('GET.lang'), ","                    time() + 60 * 60 * 24 * 360,","                    '/'","                );","                $this->f3->clear('CACHE');","                exit(header('Location: '.$this->f3->get('PATH')));","            }","        }","","        // set language","        if ($this->f3->get('COOKIE.lang')) {","            if (in_array($this->f3->get('COOKIE.lang'), $this->f3->get('SUPPORTED_LANGUAGE'))) {","                $this->f3->set('LANGUAGE', $this->f3->get('COOKIE.lang'));","            }","        }","    }","    ","}"],"id":1}],[{"start":{"row":20,"column":8},"end":{"row":21,"column":56},"action":"remove","lines":["$this->f3->set('helper', \\Model\\Helper::instance());","        $this->f3->set('rbac', \\Model\\RBAC::instance());"],"id":2}],[{"start":{"row":20,"column":8},"end":{"row":21,"column":8},"action":"remove","lines":["","        "],"id":3}],[{"start":{"row":27,"column":8},"end":{"row":46,"column":9},"action":"remove","lines":["// detect language change","        if ($this->f3->get('GET.lang')) {","            if (in_array($this->f3->get('GET.lang'), $this->f3->get('SUPPORTED_LANGUAGE'))) {","                setcookie(","                    'lang',","                    $this->f3->get('GET.lang'), ","                    time() + 60 * 60 * 24 * 360,","                    '/'","                );","                $this->f3->clear('CACHE');","                exit(header('Location: '.$this->f3->get('PATH')));","            }","        }","","        // set language","        if ($this->f3->get('COOKIE.lang')) {","            if (in_array($this->f3->get('COOKIE.lang'), $this->f3->get('SUPPORTED_LANGUAGE'))) {","                $this->f3->set('LANGUAGE', $this->f3->get('COOKIE.lang'));","            }","        }"],"id":4}],[{"start":{"row":27,"column":4},"end":{"row":27,"column":8},"action":"remove","lines":["    "],"id":5}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":4},"action":"remove","lines":["    "],"id":6}],[{"start":{"row":26,"column":8},"end":{"row":27,"column":0},"action":"remove","lines":["",""],"id":7}],[{"start":{"row":26,"column":4},"end":{"row":26,"column":8},"action":"remove","lines":["    "],"id":8}],[{"start":{"row":26,"column":0},"end":{"row":26,"column":4},"action":"remove","lines":["    "],"id":9}],[{"start":{"row":25,"column":32},"end":{"row":26,"column":0},"action":"remove","lines":["",""],"id":10}],[{"start":{"row":26,"column":5},"end":{"row":27,"column":0},"action":"insert","lines":["",""],"id":11},{"start":{"row":27,"column":0},"end":{"row":27,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":27,"column":4},"end":{"row":28,"column":0},"action":"insert","lines":["",""],"id":12},{"start":{"row":28,"column":0},"end":{"row":28,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":28,"column":4},"end":{"row":38,"column":5},"action":"insert","lines":["\t","\t/**","     * CSS loader & minify","     * 1024 = download limit","     */","    public function css(\\Base $f3, $params)","    {","        exit(\\Web::instance()->minify(","            'public/css/'.basename($params['filename'])","        ));","    }"],"id":13}],[{"start":{"row":28,"column":0},"end":{"row":28,"column":4},"action":"remove","lines":["    "],"id":14}],[{"start":{"row":27,"column":4},"end":{"row":28,"column":1},"action":"remove","lines":["","\t"],"id":15}],[{"start":{"row":29,"column":26},"end":{"row":30,"column":28},"action":"remove","lines":["","     * 1024 = download limit"],"id":18}],[{"start":{"row":29,"column":16},"end":{"row":29,"column":17},"action":"remove","lines":["r"],"id":19}],[{"start":{"row":29,"column":15},"end":{"row":29,"column":16},"action":"remove","lines":["e"],"id":20}],[{"start":{"row":23,"column":0},"end":{"row":25,"column":32},"action":"remove","lines":["        ","        // start view","        $this->view = new \\View;"],"id":21}],[{"start":{"row":22,"column":71},"end":{"row":23,"column":0},"action":"remove","lines":["",""],"id":22}],[{"start":{"row":31,"column":55},"end":{"row":33,"column":30},"action":"insert","lines":["null,","    //         true,","    //         'public/cache/'"],"id":23}],[{"start":{"row":31,"column":55},"end":{"row":31,"column":56},"action":"insert","lines":[","],"id":24}],[{"start":{"row":32,"column":4},"end":{"row":32,"column":6},"action":"remove","lines":["//"],"id":25}],[{"start":{"row":33,"column":3},"end":{"row":33,"column":6},"action":"remove","lines":[" //"],"id":26}],[{"start":{"row":31,"column":55},"end":{"row":33,"column":27},"action":"remove","lines":[",null,","             true,","            'public/cache/'"],"id":27}],[{"start":{"row":33,"column":5},"end":{"row":34,"column":0},"action":"insert","lines":["",""],"id":28},{"start":{"row":34,"column":0},"end":{"row":34,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":34,"column":4},"end":{"row":35,"column":0},"action":"insert","lines":["",""],"id":29},{"start":{"row":35,"column":0},"end":{"row":35,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":35,"column":4},"end":{"row":42,"column":5},"action":"insert","lines":["    ","    /**","     *","     */","    public function afterRoute(\\Base $f3, $params)","    {","        echo \\View::instance()->render('app/view/template.php');","    }"],"id":30}],[{"start":{"row":34,"column":0},"end":{"row":35,"column":8},"action":"remove","lines":["    ","        "],"id":31}],[{"start":{"row":33,"column":5},"end":{"row":34,"column":0},"action":"insert","lines":["",""],"id":32},{"start":{"row":34,"column":0},"end":{"row":34,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":34,"column":4},"end":{"row":35,"column":0},"action":"insert","lines":["",""],"id":33},{"start":{"row":35,"column":0},"end":{"row":35,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":35,"column":4},"end":{"row":50,"column":5},"action":"insert","lines":["    /**","     * Generate and set csrftoken into session","     * ","     * @return string - the value of csrf","     */","    public function set_csrf()","    {","        $csrf = hash('sha256', uniqid(true).microtime(true).uniqid(true));","        ","        $this->f3->mset([","            'csrf' => $csrf,","            'SESSION.csrf' => $csrf","        ]);","        ","        return $csrf;","    }"],"id":34}],[{"start":{"row":35,"column":4},"end":{"row":35,"column":8},"action":"remove","lines":["    "],"id":35}],[{"start":{"row":36,"column":28},"end":{"row":36,"column":29},"action":"insert","lines":[" "],"id":36}],[{"start":{"row":37,"column":0},"end":{"row":38,"column":41},"action":"remove","lines":["     * ","     * @return string - the value of csrf"],"id":37}],[{"start":{"row":36,"column":47},"end":{"row":37,"column":0},"action":"remove","lines":["",""],"id":38}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":20,"column":8},"end":{"row":20,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1498513998230,"hash":"68a97671cb50a904bed42dd09f2487f0b7168be5"}